{"version":3,"file":"ioSocket.js","sourceRoot":"/","sources":["src/config/ioSocket.ts"],"names":[],"mappings":";;;AAAA,yCAAmD;AACnD,2DAA+D;AAGxD,MAAM,cAAc,GAAG,CAAC,MAAmB,EAAE,EAAE;IACpD,MAAM,EAAE,GAAG,IAAI,kBAAY,CAAC,MAAM,EAAE;QAClC,UAAU,EAAE,CAAC,WAAW,CAAC;QACzB,IAAI,EAAE;YACJ,MAAM,EAAE,uBAAuB;YAC/B,OAAO,EAAE,CAAC,KAAK,EAAE,MAAM,CAAC;YACxB,WAAW,EAAE,IAAI;SAClB;KACF,CAAC,CAAC;IAEH,EAAE,CAAC,EAAE,CAAC,YAAY,EAAE,CAAC,MAAM,EAAE,EAAE;QAC7B,MAAM,CAAC,EAAE,CAAC,WAAW,EAAE,CAAC,OAAO,EAAE,EAAE;YACjC,IAAI,CAAC,8BAAiB,CAAC,GAAG,CAAC,OAAO,CAAC,EAAE,CAAC;gBACpC,8BAAiB,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;YACpC,CAAC;YAED,8BAAiB,CAAC,GAAG,CAAC,OAAO,EAAE,8BAAiB,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC;YAEnE,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAErB,EAAE,CAAC,EAAE,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,eAAe,EAAE,8BAAiB,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC;YAErE,MAAM,CAAC,EAAE,CAAC,YAAY,EAAE,GAAG,EAAE;gBAC3B,8BAAiB,CAAC,GAAG,CAAC,OAAO,EAAE,8BAAiB,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC;gBAEnE,EAAE,CAAC,EAAE,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,eAAe,EAAE,8BAAiB,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC;YACvE,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC;AA7BW,QAAA,cAAc,kBA6BzB","sourcesContent":["import { Server as SocketServer } from \"socket.io\";\r\nimport { usersViewingEvent } from \"../../src/utils/redisUtils\";\r\nimport http from \"http\";\r\n\r\nexport const setupIoSockets = (server: http.Server) => {\r\n  const io = new SocketServer(server, {\r\n    transports: [\"websocket\"],\r\n    cors: {\r\n      origin: \"http://localhost:3000\",\r\n      methods: [\"GET\", \"POST\"],\r\n      credentials: true\r\n    }\r\n  });\r\n\r\n  io.on(\"connection\", (socket) => {\r\n    socket.on(\"joinEvent\", (eventId) => {\r\n      if (!usersViewingEvent.has(eventId)) {\r\n        usersViewingEvent.set(eventId, 0);\r\n      }\r\n\r\n      usersViewingEvent.set(eventId, usersViewingEvent.get(eventId) + 1);\r\n\r\n      socket.join(eventId);\r\n\r\n      io.to(eventId).emit(\"viewersUpdate\", usersViewingEvent.get(eventId));\r\n\r\n      socket.on(\"disconnect\", () => {\r\n        usersViewingEvent.set(eventId, usersViewingEvent.get(eventId) - 1);\r\n\r\n        io.to(eventId).emit(\"viewersUpdate\", usersViewingEvent.get(eventId));\r\n      });\r\n    });\r\n  });\r\n};\r\n"]}