{"version":3,"file":"pdfGenerator.js","sourceRoot":"/","sources":["src/utils/pdfGenerator.ts"],"names":[],"mappings":"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","sourcesContent":["import PDFDocument from \"pdfkit\";\r\nimport fs from \"fs\";\r\nimport { Reservation } from \"../models/Reservation\";\r\nimport User from \"../models/User\";\r\nimport EventModel, { Event as EventType } from \"../models/Event\";\r\nimport { AppError } from \"../middlewares/errorMiddleware\";\r\nimport qr from \"qr-image\";\r\nimport { Seat } from \"../models/Hall\";\r\nimport pathFunction from \"path\";\r\n\r\nexport const generateReservationPDF = async (\r\n  reservation: Reservation,\r\n  path: string\r\n) => {\r\n  const doc = new PDFDocument({\r\n    size: \"A4\",\r\n    layout: \"portrait\",\r\n    margins: {\r\n      top: 50,\r\n      bottom: 50,\r\n      left: 50,\r\n      right: 50\r\n    }\r\n  });\r\n\r\n  doc.pipe(fs.createWriteStream(path));\r\n\r\n  const user = await User.findById(reservation.user);\r\n  if (!user) {\r\n    throw new AppError(\"User not found\", 404);\r\n  }\r\n\r\n  const event = (await EventModel.findById(reservation.event).populate(\r\n    \"hall\"\r\n  )) as EventType & { hall: { name: string } };\r\n\r\n  if (!event) {\r\n    throw new AppError(\"Event not found\", 404);\r\n  }\r\n\r\n  const seatsPerPage = 6;\r\n  const logoImage = fs.readFileSync(\r\n    pathFunction.join(\r\n      __dirname,\r\n      \"..\",\r\n      \"..\",\r\n      \"assets\",\r\n      \"default_transparent_765x625.png\"\r\n    )\r\n  );\r\n  const addHeader = () => {\r\n    doc\r\n      .fillColor(\"#333333\")\r\n      .fontSize(26)\r\n      .font(\"Helvetica-Bold\")\r\n      .image(logoImage, { align: \"center\", width: 150 })\r\n      .moveDown(0.5)\r\n      .fontSize(12)\r\n      .font(\"Helvetica\")\r\n      .fillColor(\"#555555\")\r\n      .text(`Date: ${new Date().toLocaleDateString()}`, { align: \"right\" })\r\n      .moveDown(1.5)\r\n      .fontSize(20)\r\n      .fillColor(\"#0077cc\")\r\n      .text(event.name, { align: \"center\" })\r\n      .moveDown(0.5)\r\n      .fontSize(14)\r\n      .fillColor(\"#666666\")\r\n      .text(`Date: ${new Date(event.date).toLocaleDateString()}`, {\r\n        align: \"center\"\r\n      })\r\n      .text(`Hall: ${event.hall.name}`, { align: \"center\" })\r\n      .moveDown(1);\r\n  };\r\n\r\n  const addFooter = () => {\r\n    doc\r\n      .fontSize(10)\r\n      .fillColor(\"#999999\")\r\n      .text(\"For any questions, please contact the event organizer.\", 50, 750, {\r\n        align: \"center\",\r\n        width: 500\r\n      })\r\n      .moveDown(0.5)\r\n      .fontSize(12)\r\n      .font(\"Helvetica-Bold\")\r\n      .fillColor(\"#444444\")\r\n      .text(\"Thank you for your reservation!\", { align: \"center\", width: 500 })\r\n      .fontSize(10)\r\n      .font(\"Helvetica\")\r\n      .fillColor(\"#aaaaaa\")\r\n      .text(`Page ${doc.bufferedPageRange().count}`, 50, 780, {\r\n        align: \"center\"\r\n      });\r\n  };\r\n\r\n  const addSeats = (seats: Seat[]) => {\r\n    seats.forEach((seat, index) => {\r\n      const qrImage = qr.imageSync(\r\n        `${reservation._id}-${seat.row}-${seat.number}`,\r\n        { type: \"png\" }\r\n      );\r\n\r\n      doc\r\n        .moveDown(1)\r\n        .image(qrImage, { width: 80, align: \"center\" })\r\n        .moveDown(0.5)\r\n        .fontSize(14)\r\n        .font(\"Helvetica-Bold\")\r\n        .fillColor(\"#333333\")\r\n        .text(`Row: ${seat.row}, Seat: ${seat.number}`, {\r\n          align: \"center\"\r\n        })\r\n        .moveDown(3);\r\n    });\r\n  };\r\n\r\n  addHeader();\r\n  addSeats(reservation.seats.slice(0, seatsPerPage));\r\n  addFooter();\r\n\r\n  for (let i = seatsPerPage; i < reservation.seats.length; i += seatsPerPage) {\r\n    doc.addPage();\r\n    addHeader();\r\n    addSeats(reservation.seats.slice(i, i + seatsPerPage));\r\n    addFooter();\r\n  }\r\n\r\n  doc.end();\r\n};\r\n"]}